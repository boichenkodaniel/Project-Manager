# Исправления: Фильтрация клиентов и права доступа

## Исправленные проблемы:

### 1. ✅ Селект клиентов в проекте не работает
**Проблема:** При создании проекта нельзя выбрать клиента в селекте
**Решение:**
- Добавлена фильтрация пользователей по роли "Клиент" при заполнении селекта
- Исправлена загрузка пользователей для разных ролей
- Добавлена поддержка разных форматов ролей (русские и английские названия)

### 2. ✅ Права доступа для разных ролей
**Проблема:** Не все контроллеры правильно проверяли права доступа
**Решение:**
- Добавлена проверка авторизации для всех контроллеров
- Добавлена фильтрация данных по ролям:
  - **Администратор** - видит все данные
  - **Руководитель проектов** - видит все проекты и задачи, может создавать
  - **Исполнитель** - видит только свои задачи и проекты, где участвует
  - **Клиент** - видит только свои проекты и связанные задачи/issues

### 3. ✅ Доступ к списку пользователей
**Проблема:** Только администратор мог видеть список пользователей
**Решение:**
- Руководители проектов теперь могут видеть всех пользователей (для назначения)
- Добавлен фильтр по ролям через параметр `?role=client`
- Исполнители и клиенты видят только клиентов и исполнителей

## Что было изменено:

### `src/backend/controllers/UserController.php`
- Добавлена поддержка фильтрации по ролям
- Руководители проектов могут видеть всех пользователей
- Добавлен метод `getUsersByRoles()` в модель

### `src/backend/models/UserModel.php`
- Добавлен метод `getUsersByRoles()` для получения пользователей по ролям

### `src/modules/Forms.js`
- Исправлена фильтрация клиентов при создании/редактировании проекта
- Исправлена фильтрация пользователей для назначения задач (только исполнители и руководители)
- Улучшена обработка ошибок при загрузке пользователей

### `src/backend/controllers/TaskController.php`
- Добавлена фильтрация задач по ролям:
  - Клиенты видят задачи только из своих проектов
  - Исполнители видят только свои задачи
  - Администратор и Руководитель проектов видят все задачи

### `src/backend/controllers/IssueController.php`
- Добавлена фильтрация issues по ролям:
  - Клиенты видят issues только из своих проектов
  - Исполнители видят issues из проектов, где участвуют, или созданные ими
  - Администратор и Руководитель проектов видят все issues

## Права доступа по ролям:

### Администратор
- ✅ Управление пользователями (создание, редактирование, удаление)
- ✅ Просмотр всех проектов, задач, issues
- ✅ Создание проектов и задач
- ✅ Полный доступ ко всем функциям

### Руководитель проектов
- ✅ Просмотр всех проектов и задач
- ✅ Создание проектов и задач
- ✅ Назначение исполнителей на задачи
- ✅ Просмотр всех пользователей (для назначения)
- ❌ Управление пользователями

### Исполнитель
- ✅ Просмотр своих задач
- ✅ Просмотр проектов, где участвует через задачи
- ✅ Выполнение задач (изменение статуса)
- ✅ Создание issues
- ✅ Просмотр issues из своих проектов
- ❌ Создание проектов и задач
- ❌ Управление пользователями

### Клиент
- ✅ Просмотр своих проектов
- ✅ Просмотр задач в своих проектах
- ✅ Просмотр issues в своих проектах
- ❌ Создание проектов, задач, issues
- ❌ Управление пользователями

## Как проверить:

1. Перезапустите серверы:
   ```bash
   npm run dev:full
   ```

2. Войдите как администратор или руководитель проектов

3. Создайте проект:
   - Откройте модальное окно (кнопка "+")
   - Выберите вкладку "Project"
   - В селекте "Client" должны отображаться только клиенты

4. Создайте задачу:
   - В селектах "Assigned by" и "Assigned to" должны отображаться только исполнители и руководители

5. Проверьте права доступа:
   - Войдите как исполнитель или клиент
   - Убедитесь, что видите только свои данные
   - Убедитесь, что кнопки создания скрыты

