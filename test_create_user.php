<?php
// Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

require_once 'src/backend/config/db.php';
require_once 'src/backend/models/UserModel.php';

try {
    echo "=== Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ===\n";
    
    $pdo = Database::getInstance();
    
    // Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    $testData = [
        'fullname' => 'Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
        'email' => 'test_' . time() . '@example.com',
        'login' => 'testuser_' . time(),
        'password' => 'testpass123',
        'role' => 'Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ'
    ];
    
    echo "Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸:\n";
    print_r($testData);
    
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    $userModel = new UserModel();
    $newUser = $userModel->createUser(
        $testData['fullname'],
        $testData['email'],
        $testData['role'],
        $testData['login'],
        $testData['password']
    );
    
    echo "\nâœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½:\n";
    print_r($newUser);
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ»ÑÑ
    $stmt = $pdo->prepare('SELECT * FROM "User" WHERE id = ?');
    $stmt->execute([$newUser['id']]);
    $savedUser = $stmt->fetch(PDO::FETCH_ASSOC);
    
    echo "\nĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ² Ğ‘Ğ”:\n";
    echo "- ID: " . $savedUser['id'] . "\n";
    echo "- Ğ˜Ğ¼Ñ: " . $savedUser['fullname'] . "\n";
    echo "- Email: " . $savedUser['email'] . "\n";
    echo "- Ğ›Ğ¾Ğ³Ğ¸Ğ½: " . $savedUser['login'] . "\n";
    echo "- Ğ Ğ¾Ğ»ÑŒ: " . $savedUser['role'] . "\n";
    echo "- ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ·Ğ°Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: " . (!empty($savedUser['password']) ? 'Ğ”Ğ°' : 'ĞĞµÑ‚') . "\n";
    
    // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    $stmt = $pdo->prepare('DELETE FROM "User" WHERE id = ?');
    $stmt->execute([$newUser['id']]);
    
    echo "\nğŸ§¹ Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½\n";
    echo "=== Ğ¢ĞµÑÑ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ===\n";
    
} catch (Exception $e) {
    echo "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: " . $e->getMessage() . "\n";
    exit(1);
}