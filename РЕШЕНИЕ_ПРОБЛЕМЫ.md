# Решение проблемы с селектом клиентов

## Проблемы обнаружены:

1. **Ошибка SQL:** Колонка `clientid` не существует в таблице `project`
2. **Массив users очищается** после ошибки загрузки проектов

## Решение:

### Шаг 1: Добавьте колонку clientid в базу данных

Выполните SQL скрипт:

```sql
-- Добавление колонки clientid в таблицу project
ALTER TABLE "project" 
ADD COLUMN IF NOT EXISTS clientid INTEGER REFERENCES "User"(id) ON DELETE SET NULL;
```

Или выполните файл `fix_database.sql`:

```bash
psql -U postgres -d Project-manager -f fix_database.sql
```

### Шаг 2: Проверьте структуру таблицы

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'project';
```

### Шаг 3: Перезапустите серверы

```bash
npm run dev:full
```

### Шаг 4: Проверьте наличие клиентов

Убедитесь, что в базе есть пользователи с ролью "Клиент":

```sql
SELECT id, fullname, email, role 
FROM "User" 
WHERE role = 'Клиент';
```

Если клиентов нет, создайте их через интерфейс или SQL:

```sql
INSERT INTO "User" (fullname, email, login, password, role)
VALUES (
    'Тестовый Клиент',
    'client@example.com',
    'client',
    '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', -- пароль: password
    'Клиент'
);
```

## Что было исправлено в коде:

1. ✅ Исправлена очистка массива users - теперь он не очищается при ошибке загрузки проектов
2. ✅ Добавлено подробное логирование для отладки
3. ✅ Добавлен SQL скрипт для исправления структуры БД

## После исправления:

1. Откройте консоль браузера (F12)
2. Попробуйте создать проект
3. Проверьте логи:
   - `User roles:` - должны показать всех пользователей и их роли
   - `Filtered clients:` - должны показать отфильтрованных клиентов
   - Если клиентов нет, проверьте роли в базе данных

